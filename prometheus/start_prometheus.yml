---
- name: "Start and configure Prometheus"
  hosts: prometheus
  become: yes
  vars:
    source_file: ./prometheus.yml
    dest_file: /home/ec2-user/prometheus.yml
  tasks:
    - name: Copy config file
      copy: src={{ source_file }} dest={{ dest_file }}
    - name: Copy web.yml
      copy: src=./web.yml dest=/home/ec2-user/web.yml
    - name: Pull Prometheus
      docker_image:
        name: prom/prometheus

    - name: Start Prometheus in Docker
      docker_container:
        name: PrometheusSrv
        image: prom/prometheus
        state: started
        ports:
        - "9090:9090"
        volumes:
        - /home/ec2-user/prometheus.yml:/etc/prometheus/prometheus.yml
#        command: --web.config.file=/home/ec2-user/web.yml